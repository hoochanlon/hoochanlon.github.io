const cheerio=require("cheerio"),moment=require("moment");function postsChart(t){const e=moment(t||"2020-01"),n=moment(),r=new Map;for(let t=e;t<=n;t+=864e5){const e=moment(t).format("YYYY-MM");r.has(e)||r.set(e,0)}hexo.locals.get("posts").forEach(t=>{const e=t.date.format("YYYY-MM");r.has(e)&&r.set(e,r.get(e)+1)});return`\n  <script id="postsChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)';\n      var dom = document.getElementById('posts-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var postsChart = echarts.init(dom, 'light');\n      postsChart.setOption({\n        title: { text: '文章发布统计图', x: 'center', textStyle: { color: color } },\n        tooltip: { trigger: 'axis' },\n        xAxis: { type: 'category', boundaryGap: false, data: ${JSON.stringify([...r.keys()])}, axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        yAxis: { type: 'value', axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        series: [{\n          type: 'line',\n          smooth: true,\n          showSymbol: false,\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[{ offset:0, color:'rgba(128,255,165)'},{offset:1,color:'rgba(1,191,236)'}]) },\n          data: ${JSON.stringify([...r.values()])}\n        }]\n      });\n      window.addEventListener('resize', () => postsChart.resize());\n    });\n  <\/script>`}function tagsChart(t){const e=hexo.locals.get("tags").map(t=>({name:t.name,value:t.length,path:t.path}));e.sort((t,e)=>e.value-t.value);const n=Math.min(e.length,t)||e.length;return`\n  <script id="tagsChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)';\n      var dom = document.getElementById('tags-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var tagsChart = echarts.init(dom, 'light');\n      tagsChart.setOption({\n        title: { text: 'Top ${n} 标签统计图', x: 'center', textStyle: { color: color } },\n        xAxis: { type: 'category', data: ${JSON.stringify(e.slice(0,n).map(t=>t.name))}, axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        yAxis: { type: 'value', axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        series: [{ type: 'bar', data: ${JSON.stringify(e)} }]\n      });\n      window.addEventListener('resize', () => tagsChart.resize());\n    });\n  <\/script>`}function categoriesChart(){const t=hexo.locals.get("categories").map(t=>({name:t.name,value:t.length,path:t.path,id:t._id,parentId:t.parent||"0"}));const e=JSON.stringify(function t(e,n){let r=[];return e.forEach(o=>{if(o.parentId==n){let n={...o};const a=t(e,o.id);a.length&&(n.children=a),r.push(n)}}),r}(t,"0"));return`\n  <script id="categoriesChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var dom = document.getElementById('categories-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var categoriesChart = echarts.init(dom, 'light');\n      categoriesChart.setOption({\n        title: { text: '文章分类统计图', x: 'center', textStyle: { color: '#4c4948' } },\n        tooltip: { trigger: 'item' },\n        series: [{\n          type: 'sunburst',\n          data: ${e},\n          radius: ['15%', '90%'],\n          center: ['50%', '55%'],\n          sort: 'desc',\n          itemStyle: { borderColor: '#fff', borderWidth: 2, emphasis: { focus: 'ancestor', shadowBlur: 10, shadowColor: 'rgba(0,0,0,0.3)' } }\n        }]\n      });\n      window.addEventListener('resize', () => categoriesChart.resize());\n    });\n  <\/script>`}hexo.extend.filter.register("after_render:html",function(t){const e=cheerio.load(t),n=e("#posts-chart"),r=e("#tags-chart"),o=e("#categories-chart");let a=!1;return n.length>0||r.length>0||o.length>0?(n.length>0&&0===e("#postsChart").length&&("true"===n.attr("data-encode")&&(a=!0),n.after(postsChart(n.attr("data-start")))),r.length>0&&0===e("#tagsChart").length&&("true"===r.attr("data-encode")&&(a=!0),r.after(tagsChart(r.attr("data-length")))),o.length>0&&0===e("#categoriesChart").length&&("true"===o.attr("data-encode")&&(a=!0),o.after(categoriesChart())),a?e.root().html().replace(/&amp;#/g,"&#"):e.root().html()):t},15);