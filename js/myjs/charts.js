let cheerio=require("cheerio"),moment=require("moment");function postsChart(t){t=moment(t||"2020-01");var e=moment();let r=new Map;for(let n=t;n<=e;n+=864e5){var a=moment(n).format("YYYY-MM");r.has(a)||r.set(a,0)}return hexo.locals.get("posts").forEach(t=>{t=t.date.format("YYYY-MM"),r.has(t)&&r.set(t,r.get(t)+1)}),`\n  <script id="postsChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)';\n      var dom = document.getElementById('posts-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var postsChart = echarts.init(dom, 'light');\n      postsChart.setOption({\n        title: { text: '文章发布统计图', x: 'center', textStyle: { color: color } },\n        tooltip: { trigger: 'axis' },\n        xAxis: { type: 'category', boundaryGap: false, data: ${JSON.stringify([...r.keys()])}, axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        yAxis: { type: 'value', axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        series: [{\n          type: 'line',\n          smooth: true,\n          showSymbol: false,\n          areaStyle: { color: new echarts.graphic.LinearGradient(0,0,0,1,[{ offset:0, color:'rgba(128,255,165)'},{offset:1,color:'rgba(1,191,236)'}]) },\n          data: ${JSON.stringify([...r.values()])}\n        }]\n      });\n      window.addEventListener('resize', () => postsChart.resize());\n    });\n  <\/script>`}function tagsChart(t){var e=hexo.locals.get("tags").map(t=>({name:t.name,value:t.length,path:t.path}));return`\n  <script id="tagsChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var color = document.documentElement.getAttribute('data-theme') === 'light' ? '#4c4948' : 'rgba(255,255,255,0.7)';\n      var dom = document.getElementById('tags-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var tagsChart = echarts.init(dom, 'light');\n      tagsChart.setOption({\n        title: { text: 'Top ${t=(e.sort((t,e)=>e.value-t.value),Math.min(e.length,t)||e.length)} 标签统计图', x: 'center', textStyle: { color: color } },\n        xAxis: { type: 'category', data: ${JSON.stringify(e.slice(0,t).map(t=>t.name))}, axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        yAxis: { type: 'value', axisLabel: { color: color }, axisLine: { lineStyle: { color: color } } },\n        series: [{ type: 'bar', data: ${JSON.stringify(e)} }]\n      });\n      window.addEventListener('resize', () => tagsChart.resize());\n    });\n  <\/script>`}function categoriesChart(){var t=hexo.locals.get("categories").map(t=>({name:t.name,value:t.length,path:t.path,id:t._id,parentId:t.parent||"0"}));return`\n  <script id="categoriesChart">\n    document.addEventListener('DOMContentLoaded', () => {\n      var dom = document.getElementById('categories-chart');\n      if (!dom) return;\n      if (echarts.getInstanceByDom(dom)) echarts.getInstanceByDom(dom).dispose();\n      var categoriesChart = echarts.init(dom, 'light');\n      categoriesChart.setOption({\n        title: { text: '文章分类统计图', x: 'center', textStyle: { color: '#4c4948' } },\n        tooltip: { trigger: 'item' },\n        series: [{\n          type: 'sunburst',\n          data: ${JSON.stringify(function t(e,r){let a=[];return e.forEach(n=>{var o;n.parentId==r&&(o={...n},(n=t(e,n.id)).length&&(o.children=n),a.push(o))}),a}(t,"0"))},\n          radius: ['15%', '90%'],\n          center: ['50%', '55%'],\n          sort: 'desc',\n          itemStyle: { borderColor: '#fff', borderWidth: 2, emphasis: { focus: 'ancestor', shadowBlur: 10, shadowColor: 'rgba(0,0,0,0.3)' } }\n        }]\n      });\n      window.addEventListener('resize', () => categoriesChart.resize());\n    });\n  <\/script>`}hexo.extend.filter.register("after_render:html",function(t){var e=cheerio.load(t),r=e("#posts-chart"),a=e("#tags-chart"),n=e("#categories-chart");let o=!1;return 0<r.length||0<a.length||0<n.length?(0<r.length&&0===e("#postsChart").length&&("true"===r.attr("data-encode")&&(o=!0),r.after(postsChart(r.attr("data-start")))),0<a.length&&0===e("#tagsChart").length&&("true"===a.attr("data-encode")&&(o=!0),a.after(tagsChart(a.attr("data-length")))),0<n.length&&0===e("#categoriesChart").length&&("true"===n.attr("data-encode")&&(o=!0),n.after(categoriesChart())),o?e.root().html().replace(/&amp;#/g,"&#"):e.root().html()):t},15);