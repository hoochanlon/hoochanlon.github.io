let year,month,week,date,dates,weekStr,monthStr,asideTime;function initializeCard(){cardTimes(),cardRefreshTimes()}function getNextFestivalDate(){const e=new Date,t=e.getFullYear(),a=[{name:"元旦",month:1,day:1},{name:"清明节",month:4,day:4},{name:"国庆节",month:10,day:1}],n=[{name:"春节",month:1,day:1},{name:"端午节",month:5,day:5},{name:"中秋节",month:8,day:15}],r=[];return[t,t+1].forEach(t=>{a.forEach(({name:a,month:n,day:d})=>{const o=new Date(t,n-1,d);o>=e&&r.push({name:a,date:o})})}),[t,t+1].forEach(t=>{n.forEach(({name:a,month:n,day:d})=>{const o=chineseLunar.lunarToSolar(t,n,d),c=new Date(o.getFullYear(),o.getMonth(),o.getDate());c>=e&&r.push({name:a,date:c})})}),0===r.length?null:r.sort((e,t)=>e.date-t.date)[0]}function cardRefreshTimes(){const e=document.getElementById("card-schedule");if(!e)return;const t=(new Date-asideTime)/864e5;e.querySelector("#pBar_year").value=t,e.querySelector("#p_span_year").innerText=(t/365*100).toFixed(1)+"%",e.querySelector(".schedule-r0 .aside-span2 a").innerText=(365-t).toFixed(0),e.querySelector("#pBar_month").value=date,e.querySelector("#pBar_month").max=dates,e.querySelector("#p_span_month").innerText=(date/dates*100).toFixed(1)+"%",e.querySelector(".schedule-r1 .aside-span2 a").innerText=dates-date;const a=0===week?7:week;e.querySelector("#pBar_week").value=a,e.querySelector("#pBar_week").max=7,e.querySelector("#p_span_week").innerText=(a/7*100).toFixed(1)+"%",e.querySelector(".schedule-r2 .aside-span2 a").innerText=7-a}function cardTimes(){const e=((e=new Date)=>{const t=e.toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"});return new Date(t.split(" ")[0]+" 00:00:00")})();year=e.getFullYear(),month=e.getMonth(),week=e.getDay(),date=e.getDate(),monthStr=`${month+1}月`,weekStr=["周日","周一","周二","周三","周四","周五","周六"][week],dates=[31,year%4==0&&year%100!=0||year%400==0?29:28,31,30,31,30,31,31,30,31,30,31][month],asideTime=new Date(`${year}/01/01 00:00:00`);const t=Math.ceil((e-asideTime)/864e5)+1,a=week-t%7>=0?Math.ceil(t/7):Math.ceil(t/7)+1,n=getNextFestivalDate(),r=Math.ceil((n.date-e)/864e5),d=formatDateYMD(n.date),o=document.getElementById("card-schedule");o&&(o.querySelector("#schedule-title").innerText=`距离${n.name}`,o.querySelector("#schedule-date").innerText=d,o.querySelector("#schedule-days").innerText=r);const c=document.getElementById("card-calendar");if(c){c.querySelector("#calendar-week").innerHTML=`${year.toString().slice(-2)}年${monthStr}&nbsp;${weekStr}`,c.querySelector("#calendar-date").innerHTML=String(date).padStart(2,"0"),c.querySelector("#calendar-solar").innerHTML=`第${a}周 第${t}天`;const n=chineseLunar.solarToLunar(e),r=chineseLunar.format(n,"T"),d=chineseLunar.format(n,"A"),o=chineseLunar.format(n,"M"),i=chineseLunar.format(n,"d");c.querySelector("#calendar-lunar").innerHTML=`${r}${d}年 ${o}${i}`}renderCalendarGrid()}function formatDateYMD(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function renderCalendarGrid(){const e=document.querySelector("#calendar-main");if(!e)return;e.innerHTML="";const t=new Date(year,month,1).getDay(),a=t+dates,n=Math.ceil(a/7);let r=1;for(let a=0;a<n;a++){const n=document.createElement("div");n.className=`calendar-r${a}`;for(let e=0;e<7;e++){const d=7*a+e,o=document.createElement("div");o.className=`calendar-d${e}`;const c=document.createElement("a");d>=t&&r<=dates?(c.textContent=r,r===date&&c.classList.add("now"),r++):c.innerHTML="&nbsp;",o.appendChild(c),n.appendChild(o)}e.appendChild(n)}}document.addEventListener("DOMContentLoaded",initializeCard),document.addEventListener("pjax:complete",initializeCard);