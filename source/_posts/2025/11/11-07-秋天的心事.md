---
title: ç§‹å¤©çš„å¿ƒäº‹
noticeOutdate: false
categories: åšå®¢ä¸»é¢˜
tags:
  - åšå®¢æ•ˆæœä»£ç 
description: ç›¸å…³ä¼˜åŒ–éƒ¨åˆ†
abbrlink: 48976
date: 2025-11-07 14:52:09
---


### è¿”å›é¦–é¡µ ä¼˜åŒ– è¿”å›æ–‡ç« æ‰€åœ¨é¡µ 

`themes\butterfly\languages\zh-CN.yml`

```
post:
  back_to_home: è¿”å›é¦–é¡µ
  back_to_current_page: è¿”å›æ–‡ç« æ‰€åœ¨é¡µ
```


{%note success%}
å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œå…¨éƒ¨æ›¿æ¢
{%endnote%}

`\themes\butterfly\layout\includes\mixins\indexPostUI.pug`


```
// ==========================
// Butterfly é¦–é¡µæ–‡ç« åˆ—è¡¨æ¨¡æ¿
// å¢åŠ åˆ†é¡µæ¥æºå‚æ•° (?from=page.current)
// ==========================

mixin indexPostUI()
  - const indexLayout = theme.index_layout
  - const masonryLayoutClass = (indexLayout === 6 || indexLayout === 7) ? 'masonry' : ''
  #recent-posts.recent-posts.nc(class=masonryLayoutClass)
    .recent-post-items
      each article, index in page.posts.data
        .recent-post-item
          - const link = article.link || article.path
          - const title = article.title || _p('no_title')
          - const leftOrRight = indexLayout === 3 ? (index % 2 === 0 ? 'left' : 'right') : (indexLayout === 2 ? 'right' : '')
          - const post_cover = article.cover
          - const no_cover = article.cover === false || !theme.cover.index_enable ? 'no-cover' : ''
          - const linkWithPage = link + (page.current ? '?from=' + page.current : '') // âœ… åˆ†é¡µå‚æ•°æ ¸å¿ƒ

          if post_cover && theme.cover.index_enable
            .post_cover(class=leftOrRight)
              a(href=url_for(linkWithPage) title=title)
                if article.cover_type === 'img'
                  img.post-bg(src=url_for(post_cover) onerror=`this.onerror=null;this.src='${url_for(theme.error_img.post_page)}'` alt=title)
                else
                  div.post-bg(style=`background: ${post_cover}`)
          .recent-post-info(class=no_cover)
            // âœ… å¸¦åˆ†é¡µå‚æ•°çš„æ ‡é¢˜é“¾æ¥
            a.article-title(href=url_for(linkWithPage) title=title)
              if globalPageType === 'home' && (article.top || article.sticky > 0)
                i.fas.fa-thumbtack.sticky
              = title

            .article-meta-wrap
              if theme.post_meta.page.date_type
                span.post-meta-date
                  if theme.post_meta.page.date_type === 'both'
                    i.far.fa-calendar-alt
                    span.article-meta-label=_p('post.created')
                    time.post-meta-date-created(datetime=date_xml(article.date) title=_p('post.created') + ' ' + full_date(article.date))= date(article.date, config.date_format)
                    span.article-meta-separator |
                    i.fas.fa-history
                    span.article-meta-label=_p('post.updated')
                    time.post-meta-date-updated(datetime=date_xml(article.updated) title=_p('post.updated') + ' ' + full_date(article.updated))= date(article.updated, config.date_format)
                  else
                    - const data_type_updated = theme.post_meta.page.date_type === 'updated'
                    - const date_type = data_type_updated ? 'updated' : 'date'
                    - const date_icon = data_type_updated ? 'fas fa-history' : 'far fa-calendar-alt'
                    - const date_title = data_type_updated ? _p('post.updated') : _p('post.created')
                    i(class=date_icon)
                    span.article-meta-label= date_title
                    time(datetime=date_xml(article[date_type]) title=date_title + ' ' + full_date(article[date_type]))= date(article[date_type], config.date_format)

              if theme.post_meta.page.categories && article.categories.data.length > 0
                span.article-meta
                  span.article-meta-separator |
                  each item, index in article.categories.data
                    i.fas.fa-inbox
                    a(href=url_for(item.path)).article-meta__categories #[=item.name]
                    if index < article.categories.data.length - 1
                      i.fas.fa-angle-right.article-meta-link

              if theme.post_meta.page.tags && article.tags.length > 0
                span.article-meta.tags
                  span.article-meta-separator |
                  each item, index in article.tags.data
                    i.fas.fa-tag
                    a(href=url_for(item.path)).article-meta__tags #[=item.name]
                    if index < article.tags.data.length - 1
                      span.article-meta-link #[='â€¢']

              mixin countBlockInIndex
                - needLoadCountJs = true
                span.article-meta
                  span.article-meta-separator |
                  i.fas.fa-comments
                  if block
                    block
                  span.article-meta-label= ' ' + _p('card_post_count')

              if theme.comments.card_post_count && theme.comments.use
                case theme.comments.use[0]
                  when 'Disqus'
                  when 'Disqusjs'
                    +countBlockInIndex
                      a.disqus-count(href=full_url_for(linkWithPage) + '#post-comment')
                        i.fa-solid.fa-spinner.fa-spin
                  when 'Valine'
                    +countBlockInIndex
                      a(href=url_for(linkWithPage) + '#post-comment')
                        span.valine-comment-count(data-xid=url_for(linkWithPage))
                          i.fa-solid.fa-spinner.fa-spin
                  when 'Waline'
                    +countBlockInIndex
                      a(href=url_for(linkWithPage) + '#post-comment')
                        span.waline-comment-count(data-path=url_for(linkWithPage))
                          i.fa-solid.fa-spinner.fa-spin
                  when 'Twikoo'
                    +countBlockInIndex
                      a.twikoo-count(href=url_for(linkWithPage) + '#post-comment')
                        i.fa-solid.fa-spinner.fa-spin
                  when 'Facebook Comments'
                    +countBlockInIndex
                      a(href=url_for(linkWithPage) + '#post-comment')
                        span.fb-comments-count(data-href=urlNoIndex(article.permalink))
                  when 'Remark42'
                    +countBlockInIndex
                      a(href=url_for(linkWithPage) + '#post-comment')
                        span.remark42__counter(data-url=urlNoIndex(article.permalink))
                          i.fa-solid.fa-spinner.fa-spin
                  when 'Artalk'
                    +countBlockInIndex
                      a(href=url_for(linkWithPage) + '#post-comment')
                        span.artalk-count(data-page-key=url_for(linkWithPage))
                          i.fa-solid.fa-spinner.fa-spin

            - const content = postDesc(article)
            if content
              .content!=content

        if theme.ad && theme.ad.index
          if (index + 1) % 3 === 0
            .recent-post-item.ads-wrap!= theme.ad.index

    include ../pagination.pug
```


`themes\butterfly\layout\tag.pug`

```
extends includes/layout.pug

block content
  // ============================================================
  // æ ‡ç­¾é¡µæ¨¡æ¿ tag.pug
  // ä¸ºæ–‡ç« é“¾æ¥é™„å¸¦ from=tags/<æ ‡ç­¾å>&page=é¡µç 
  // ============================================================

  include ./includes/mixins/article-sort.pug

  #tag
    .article-sort-title
      i.fa-solid.fa-tags
      |  #{_p('page.tag')} - #{page.tag}

    // âœ… ä¼ é€’æ ‡ç­¾è·¯å¾„ä¸é¡µç 
    +articleSort(page.posts, { fromPath: 'tags/' + page.tag, currentPage: page.current })

    include includes/pagination.pug
```


`\themes\butterfly\layout\archive.pug`

```
extends includes/layout.pug

block content
  // ============================================================
  // å½’æ¡£é¡µæ¨¡æ¿ archive.pug
  // è‡ªåŠ¨ä¸ºæ–‡ç« é“¾æ¥é™„åŠ æ¥æºå‚æ•°ï¼šfrom=archives&page=é¡µç 
  // ============================================================

  include ./includes/mixins/article-sort.pug

  #archive
    #posts-calendar.js-pjax
    .article-sort-title
      i.fa-solid.fa-box-archive
      |  #{_p('page.articles')} - #{getArchiveLength()}

    // âœ… ä¼ é€’å›ºå®šæ¥æºè·¯å¾„ "archives"
    +articleSort(page.posts, { fromPath: 'archives', currentPage: page.current })

    include includes/pagination.pug
```

`\themes\butterfly\layout\includes\mixins\article-sort.pug`


```
// ============================================================
// æ–‡ç« åˆ—è¡¨æ’åºç»„ä»¶ï¼ˆé€‚ç”¨äºåˆ†ç±»é¡µã€æ ‡ç­¾é¡µã€å½’æ¡£é¡µç­‰ï¼‰
// è‡ªåŠ¨è¯†åˆ«æ¥æºè·¯å¾„ (fromPath) å’Œå½“å‰åˆ†é¡µé¡µç  (currentPage)
// ============================================================

mixin articleSort(posts, opts)
  -
    // 1ï¸âƒ£ è·å–ä¼ å…¥å‚æ•°ï¼ˆæ¥æºè·¯å¾„å’Œå½“å‰é¡µç ï¼‰
    const fromPath = (opts && opts.fromPath) ? opts.fromPath : ''
    const currentPage = (opts && opts.currentPage) ? opts.currentPage : ''

  .article-sort
    - let year
    - posts.forEach(article => {
      // 2ï¸âƒ£ è·å–æ–‡ç« æ‰€å±å¹´ä»½ï¼Œç”¨äºæ—¶é—´åˆ†ç»„
      - const tempYear = date(article.date, 'YYYY')

      // 3ï¸âƒ£ åˆ¤æ–­æ–‡ç« æ˜¯å¦æœ‰å°é¢ï¼Œç”¨äºæ ·å¼åŒºåˆ†
      - const noCoverClass = article.cover === false || !theme.cover.archives_enable ? 'no-article-cover' : ''
      - const title = article.title || _p('no_title')

      // 4ï¸âƒ£ ç”Ÿæˆæ–‡ç« åŸºç¡€é“¾æ¥
      - const baseLink = url_for(article.path)

      // 5ï¸âƒ£ æ‹¼æ¥æ¥æºå‚æ•°ï¼ˆå¿…é¡»ä¸€è¡Œå†™å®Œï¼ï¼‰
      - const href = (fromPath && currentPage) ? baseLink + '?from=' + fromPath + '&page=' + currentPage : baseLink

      // 6ï¸âƒ£ å½“å¹´ä»½å˜åŒ–æ—¶æ˜¾ç¤ºå¹´ä»½æ ‡ç­¾
      if tempYear !== year
        - year = tempYear
        .article-sort-item.year= year

      // 7ï¸âƒ£ æ¸²æŸ“æ–‡ç« æ¡ç›®
      .article-sort-item(class=noCoverClass)
        if article.cover && theme.cover.archives_enable
          a.article-sort-item-img(href=href title=title)
            if article.cover_type === 'img'
              img(
                src=url_for(article.cover)
                alt=title
                onerror=`this.onerror=null;this.src='${url_for(theme.error_img.post_page)}'`
              )
            else
              div(style=`background: ${article.cover}`)
        .article-sort-item-info
          .article-sort-item-time
            i.far.fa-calendar-alt
            time.post-meta-date-created(
              datetime=date_xml(article.date)
              title=_p('post.created') + ' ' + full_date(article.date)
            )= date(article.date, config.date_format)

          // 8ï¸âƒ£ å¸¦æ¥æºå‚æ•°çš„æ–‡ç« æ ‡é¢˜é“¾æ¥
          a.article-sort-item-title(href=href title=title)= title
    - })
```



`\themes\butterfly\layout\includes\header\nav.pug`


```
// ============================================================
// Butterfly ä¸»é¢˜å¯¼èˆªæ  nav.pug
// æ”¯æŒåŠ¨æ€è¿”å›åˆ†ç±» / æ ‡ç­¾ / å½’æ¡£ / é¦–é¡µåˆ†é¡µæ¥æº
// ============================================================

nav#nav
  span#blog-info
    // ========================
    // éæ–‡ç« é¡µï¼šæ˜¾ç¤ºç«™ç‚¹æ ‡é¢˜
    // ========================
    if globalPageType !== 'post'
      a.nav-site-title(href=url_for('/'))
        if theme.nav.logo
          img.site-icon(src=url_for(theme.nav.logo) alt='Logo')
        if theme.nav.display_title
          span.site-name=config.title

    // ========================
    // æ–‡ç« é¡µï¼šæ˜¾ç¤ºæ–‡ç« æ ‡é¢˜ä¸è¿”å›æŒ‰é’®
    // ========================
    if globalPageType === 'post' && theme.nav.display_post_title
      // åˆå§‹ä¸ºä¸»é¡µé“¾æ¥ï¼Œç¨å JS åŠ¨æ€ä¿®æ”¹ä¸ºæ¥æºè·¯å¾„
      a.nav-page-title#nav-back(href=url_for('/'))
        span.site-name= page.title || config.title
        span.site-name
          i.fa-solid.fa-circle-arrow-left
          // é»˜è®¤æ˜¾ç¤ºâ€œè¿”å›é¦–é¡µâ€ï¼ŒJS åŠ¨æ€åˆ‡æ¢
          span#nav-back-text= ' ' + _p('post.back_to_home')

  // ========================
  // èœå•åŒºåŸŸ
  // ========================
  #menus
    if theme.menu
      != partial('includes/header/menu_item', {}, {cache: true})
      #toggle-menu
        span.site-page
          i.fas.fa-bars.fa-fw

  // ========================
  // æœç´¢æŒ‰é’®
  // ========================
  if theme.search.use
    #search-button
      span.site-page.social-icon.search
        i.fas.fa-search.fa-fw
        //- span= ' ' + _p('search.title')


// ============================================================
// âœ… JS åŠ¨æ€åˆ¤æ–­æ¥æºï¼šåˆ†é¡µ / åˆ†ç±» / æ ‡ç­¾ / å½’æ¡£ â†’ è¿”å›æ‰€åœ¨é¡µï¼Œå¦åˆ™è¿”å›é¦–é¡µ
// ============================================================
script.
  (function() {
    var backLink = document.getElementById('nav-back');
    var backText = document.getElementById('nav-back-text');
    if (!backLink || !backText) return;

    // è¯»å– URL å‚æ•°
    var params = new URLSearchParams(window.location.search);
    var from = params.get('from');     // æ¥æºè·¯å¾„ï¼Œå¦‚ categories/è€ƒè¯•ã€tags/ç¬”è®°ã€archivesã€page
    var pageNum = params.get('page');  // å½“å‰é¡µç ï¼ˆæ•°å­—ï¼‰

    if (from) {
      // âœ… ç¡®ä¿è·¯å¾„ç»“å°¾å¸¦æ–œæ 
      var base = from.replace(/\/?$/, '/');
      var href = '/'; // é»˜è®¤è¿”å›é¦–é¡µ

      if (pageNum && /^\d+$/.test(pageNum)) {
        // æœ‰é¡µç æ—¶è¿”å›å¯¹åº”åˆ†é¡µ
        href = (pageNum === '1')
          ? '/' + base
          : '/' + base + 'page/' + pageNum + '/#content-inner';
      } else {
        // æ— é¡µç  â†’ ç¬¬ä¸€é¡µï¼ˆåˆ†ç±»ç¬¬ä¸€é¡µ / æ ‡ç­¾ç¬¬ä¸€é¡µï¼‰
        href = '/' + base;
      }

      // è®¾ç½®è¿”å›æŒ‰é’®
      backLink.href = href;
      backText.textContent = ' ' + '#{_p("post.back_to_current_page")}';

      // ğŸ§© è°ƒè¯•è¾“å‡ºï¼Œå¯æŸ¥çœ‹å®é™…è¿”å›è·¯å¾„
      console.log('[Butterfly] è¿”å›è·¯å¾„:', href);

    } else {
      // âœ… æ²¡æœ‰ from å‚æ•° â†’ è¿”å›é¦–é¡µ
      backLink.href = '/';
      backText.textContent = ' ' + '#{_p("post.back_to_home")}';
    }
  })();
```



### åˆ†é¡µ


`\themes\butterfly\layout\includes\pagination.pug`

```
if page.total !== 1
  -
    const total = page.total
    const current = page.current
    const groupSize = 5   // æ¯ç»„æ˜¾ç¤ºå¤šå°‘é¡µ
    const groupIndex = Math.ceil(current / groupSize)
    const startPage = (groupIndex - 1) * groupSize + 1
    const endPage = Math.min(startPage + groupSize - 1, total)
    const prevGroupPage = startPage - groupSize
    const nextGroupPage = endPage + 1

    // å›¾æ ‡
    const prevText = '<i class="fas fa-chevron-left fa-fw"></i>'
    const nextText = '<i class="fas fa-chevron-right fa-fw"></i>'
    const prevGroupText = '<i class="fas fa-angles-left fa-fw"></i>'
    const nextGroupText = '<i class="fas fa-angles-right fa-fw"></i>'

    // âœ… è‡ªåŠ¨è¯†åˆ«å½“å‰åˆ†é¡µåŸºç¡€è·¯å¾„ï¼ˆé¦–é¡µ / åˆ†ç±» / æ ‡ç­¾ / å½’æ¡£ï¼‰
    const base = page.base || '/'

    // âœ… é€šç”¨åˆ†é¡µé“¾æ¥ç”Ÿæˆå‡½æ•°
    const pageLink = (num) => {
      if (num === 1) return url_for(base)
      return url_for(`${base.replace(/\/?$/, '/') }page/${num}/#content-inner`)
    }

  nav#pagination
    .pagination
      // ä¸Šä¸€ç»„
      if prevGroupPage >= 1
        a.extend.group-prev(href=pageLink(prevGroupPage))!= prevGroupText

      // ä¸Šä¸€é¡µ
      if current > 1
        a.extend.prev(href=pageLink(current - 1))!= prevText

      // å½“å‰ç»„é¡µç å¾ªç¯ï¼ˆå¸¦å®‰å…¨åˆ¤æ–­ï¼‰
      if endPage >= startPage
        each i in Array(endPage - startPage + 1).fill().map((_, idx) => startPage + idx)
          if i === current
            span.page-number.current= i
          else
            a.page-number(href=pageLink(i))= i

      // ä¸‹ä¸€é¡µ
      if current < total
        a.extend.next(href=pageLink(current + 1))!= nextText

      // ä¸‹ä¸€ç»„
      if nextGroupPage <= total
        a.extend.group-next(href=pageLink(nextGroupPage))!= nextGroupText

```



### nav é•¿æ ‡é¢˜æ»šåŠ¨

####  v2

è‡ªå®šä¹‰css

```
 /* å…¬äº¤è½¦ç”µå­å±æ•ˆæœ */
.nav-page-title {
  display: inline-flex;
  align-items: center;
  overflow: hidden;
  max-width: 220px;
  vertical-align: middle;
  text-decoration: none;
}

/* é»˜è®¤ä¸æ»šåŠ¨ */
.nav-page-title .site-name:first-child {
  display: inline-block;
  white-space: nowrap;
  padding-left: 0;
  animation: none;
  padding-top: 8px;
  padding-bottom: 8px;
}

/* å¯ç”¨æ»šåŠ¨åŠ¨ç”»æ—¶ */
.nav-page-title .site-name:first-child.scroll-enabled {
  padding-left: 100%;
  animation: navMarquee 15s linear infinite;
}

/* é¼ æ ‡æ‚¬åœæš‚åœæ»šåŠ¨ */
.nav-page-title:hover .site-name:first-child.scroll-enabled {
  animation-play-state: paused;
}

/* è¿”å›æŒ‰é’®å›ºå®šåŒºåŸŸ */
.nav-page-title .site-name:last-child {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
  flex-shrink: 0;
  animation: none !important;
}

/* æ»šåŠ¨åŠ¨ç”»å…³é”®å¸§ */
@keyframes navMarquee {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}
```


`\themes\butterfly\layout\includes\header\nav.pug`


æœ«å°¾æ·»åŠ 

```pug
script.
  (function() {
    function checkTitleScroll() {
      const title = document.querySelector('.nav-page-title .site-name:first-child');
      const container = document.querySelector('.nav-page-title');
      if (!title || !container) return;
      // è§¦å‘å¸ƒå±€è®¡ç®—
      title.offsetWidth;

      if (title.scrollWidth > container.clientWidth) {
        title.classList.add('scroll-enabled');
      } else {
        title.classList.remove('scroll-enabled');
      }
    }

    window.addEventListener('load', () => {
      setTimeout(checkTitleScroll, 300);

      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => setTimeout(checkTitleScroll, 100));
      }
    });

    if (document.fonts) {
      document.fonts.addEventListener('loadingdone', checkTitleScroll);
    }

    window.addEventListener('resize', checkTitleScroll);
  })();
```
