nav#nav
  span#blog-info
    // 非文章页显示站点标题
    if globalPageType !== 'post'
      a.nav-site-title(href=url_for('/'))
        if theme.nav.logo
          img.site-icon(src=url_for(theme.nav.logo) alt='Logo')
        if theme.nav.display_title
          span.site-name=config.title

    // 文章页显示文章标题和返回按钮
    if globalPageType === 'post' && theme.nav.display_post_title
      // 初始为主页链接，稍后通过 JS 改为分页来源
      a.nav-page-title#nav-back(href=url_for('/'))
        span.site-name= page.title || config.title
        span.site-name
          i.fa-solid.fa-circle-arrow-left
          // 默认显示“返回首页”，JS 动态切换
          span#nav-back-text= ' ' + _p('post.back_to_home')

  #menus
    if theme.menu
      != partial('includes/header/menu_item', {}, {cache: true})
      #toggle-menu
        span.site-page
          i.fas.fa-bars.fa-fw

  if theme.search.use
    #search-button
      span.site-page.social-icon.search
        i.fas.fa-search.fa-fw
        //- span= ' ' + _p('search.title')


// ✅ JS 动态判断来源：分页 → “返回所在页”，否则 → “返回首页”
script.
  (function() {
    var backLink = document.getElementById('nav-back');
    var backText = document.getElementById('nav-back-text');
    if (!backLink || !backText) return;

    var from = new URLSearchParams(window.location.search).get('from');

    if (from && /^\d+$/.test(from)) {
      // 来自分页页，例如 ?from=3
      backLink.href = (from === '1') ? '/' : '/page/' + from + '/#content-inner';
      backText.textContent = ' ' + '#{_p("post.back_to_current_page")}';
    } else {
      // 其他来源，返回首页
      backLink.href = '/';
      backText.textContent = ' ' + '#{_p("post.back_to_home")}';
    }
  })();


//- ✅ JS 动态判断标题宽度，超出则启用滚动效果
script.
  (function() {
    function checkTitleScroll() {
      const title = document.querySelector('.nav-page-title .site-name:first-child');
      const container = document.querySelector('.nav-page-title');
      if (!title || !container) return;
      // 触发布局计算
      title.offsetWidth;

      if (title.scrollWidth > container.clientWidth) {
        title.classList.add('scroll-enabled');
      } else {
        title.classList.remove('scroll-enabled');
      }
    }

    window.addEventListener('load', () => {
      setTimeout(checkTitleScroll, 300);

      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => setTimeout(checkTitleScroll, 100));
      }
    });

    if (document.fonts) {
      document.fonts.addEventListener('loadingdone', checkTitleScroll);
    }

    window.addEventListener('resize', checkTitleScroll);
  })();
