---
title: Linuxä¸Sambaä¹‹é—´çš„æƒé™ Part1
author: hoochanlon
categories: [chip]
tags: [chip]
date: 2020-11-08 18:40:12
---

Sambaå®‰è£…é…ç½®è¿‡ç¨‹è„šæœ¬ä¹‹å®¶çš„è¿™ç¯‡æ–‡ç« å†™çš„å¾ˆè¯¦ç»†ï¼š [jb51net-Centos 7 SambaæœåŠ¡å®‰è£…æ–¹æ³•è¯¦è§£](https://www.jb51.net/article/162573.htm)ï¼Œæ­¤å¤–æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„æƒé™åˆ†é…çš„é—®é¢˜ï¼š

* smbã€nmbæœåŠ¡å¼€å¯ï¼ˆnmbæœåŠ¡æ˜¯è´Ÿè´£è§£æç”¨çš„ï¼Œç±»ä¼¼ä¸DNSå®ç°çš„åŠŸèƒ½ï¼‰
* selinux ä¸ firewalld ç¦ç”¨
* å»ºè®®æ³¨é‡Šæ‰homeså†é…ç½®å…±äº«ï¼ˆhomesç”Ÿæˆçš„ç›®å½•ï¼Œåå€’æˆäº†å¹²æ‰°ï¼‰
* smb è¯»å†™æ‰§è¡Œä¾èµ–äºLinuxç³»ç»Ÿç”¨æˆ·æƒé™

<!-- more -->

[ç¬¬åå…­ç« ã€æª”æ¡ˆä¼ºæœå™¨ä¹‹äºŒï¼š SAMBA ä¼ºæœå™¨](http://linux.vbird.org/linux_server/0370samba.php)

readï¼šrï¼Œwriteï¼šwï¼Œexecuteï¼šxï¼›rwxæ•´åˆåœ¨ä¸€èµ·å°±æ˜¯å¯è¯»å¯å†™å¯æ‰§è¡Œã€‚

> å›¾ç‰‡æ•´åˆè‡ª [csdn-qq_42325315-linuxæƒé™è¯´æ˜](https://blog.csdn.net/qq_42325315/article/details/80474607)

![20180604003458118.png](https://i.loli.net/2020/11/04/5Q9GfDTuqU2aIzH.png)

sambaæƒé™æ˜¯åœ¨Linuxåˆ†é…æƒé™åŸºç¡€ä¹‹ä¸Šå†è¿›è¡Œè°ƒé…çš„ï¼Œä¾‹å¦‚Linuxçš„æ™®é€šç”¨æˆ·æƒé™ä¸å¤Ÿï¼Œåœ¨smbè®¾ç½®æˆ777ä¹‹ç±»æƒé™ä¹Ÿæ— æµäºäº‹ï¼Œä¾æ—§è®¿é—®ä¸äº†smbè®¾å®šçš„å…±äº«ç›®å½•ï¼›åœ¨sambaåˆ›å»ºäº†rootç”¨æˆ·ï¼Œä½†åœ¨sambaä¸­æœªå¯¹rootè¿›è¡Œé…ç½®æŒ‡å®šçš„ç›®å½•è®¿é—®æƒé™ï¼Œå°±ç®—ç”¨rootç™»å½•ä¹Ÿæ˜¯ä¸èƒ½è®¿é—®è¯¥ç›®å½•çš„ã€‚

å…³äºä¸Šè¿°å¯ä»¥ç”¨`su æ™®é€šç”¨æˆ·å`åˆ‡æ¢ç™»å½•ï¼Œç„¶ååˆ°ç›®å½•ä¸­è¿›è¡Œrwxå®éªŒï¼Œï¼Œè¿™ä¹Ÿæ˜¯å»ºè®®åˆæ¬¡æ­å»ºsambaå»ºè®®æœ€å¥½ä¹Ÿåˆ›å»ºä¸€ä¸ªrootçº§çš„smbç”¨æˆ·çš„åŸå› ï¼Œæ–¹ä¾¿ç ”ç©¶ä¸æ•…éšœæ’æŸ¥ã€‚

```shell
# Linuxåˆ†é…ç›®å½•æƒé™ 

## åˆ›å»ºç»„å¹¶å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°ç»„å†…ï¼Œå‚æ•°å‰é¢ç¬¬ä¸€ä¸ªguestä¸ºç»„å
groupadd guest && useradd -g guest guest && passwd
## èµ‹ç»™ç”¨æˆ·guestè¯»å†™æ‰§è¡Œæƒé™åˆ° /home/guest/data ç›®å½•
setfacl -m u:guest:rwx -R /home/guest/data/
## èµ‹ç»™guestç»„è¯»å†™æ‰§è¡Œæƒé™åˆ° /home/guest/data ç›®å½•
setfacl -m g:guest:rwx -R /home/guest/data

# å‚è€ƒ https://www.cnblogs.com/Jimmy1988/p/7260215.html
```

æ‰©å±•é˜…è¯»äº†[Linuxæ–‡ä»¶æƒé™ä¸å±æ€§è¯¦è§£ ä¹‹ SUIDã€SGID & SBIT](https://www.cnblogs.com/Jimmy1988/p/7260215.html)ï¼Œéƒ¨åˆ†æ–‡ä»¶é™¤rwxé¢å¤–å¸¦â€œsâ€ä¸â€œtâ€ï¼Œså³ä¸ºè®¾ç½®uidã€gidï¼Œtå³ä¸ºç²˜æ»ä½ï¼Œç²˜æ»ä½ä½œç”¨æ˜¯ä»¥é˜²æ­¢æ™®é€šç”¨æˆ·åˆ é™¤æˆ–ç§»åŠ¨å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶ã€‚

## å¯¹ç”¨æˆ·åŠç»„â€œæ‰€å±è€…â€œä¸â€æƒé™â€œè¸©å‘è¿‡ç¨‹

æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·publicï¼ŒåŠ å…¥guestç»„`useradd -g guest public && passwd` ã€‚å†å°†guestç”¨æˆ·è®¾ç½®æˆåŒåç»„çš„ç®¡ç†å‘˜` gpasswd -A guestï¼ˆç”¨æˆ·ï¼‰ guest`è¯•ä¸‹ç²˜æ»ä½ã€‚

åˆ«å¿˜äº†åˆ›å»ºç³»ç»Ÿç”¨æˆ·çš„åŒæ—¶ï¼Œç›¸å¯¹çš„ç»™smbä¹Ÿåˆ›å»ºä¸€ä¸ªï¼Œä½†è¿›å…¥"æ¥å®¾å…±äº«èµ„æºç›®å½•"å‡ºç°äº†æ„å¤–ã€‚ğŸ˜

![1-37-51.png](https://i.loli.net/2020/11/08/NVXeuUYiwoagC7O.png)

```shell
setfacl -m g:guest:rwx -R /home/guest/æ¥å®¾å…±äº«ç›®å½•
systemctl restart smb
```

é…ç½®äº†å¦‚ä¸ŠæŒ‡ä»¤è¿˜æ˜¯è®¿é—®æ— æ•ˆï¼Œæ¥ç€å°†æ¥å®¾ç›®å½•çš„rwxèµ‹ç»™testç»„ï¼Œå°†ç”¨æˆ·peteråŠ å…¥åˆ°è¯¥ç»„ä¸­ï¼Œsmbçš„valid usersä¹Ÿæ”¹æˆ@testï¼Œè¿›è¡Œæµ‹è¯•ï¼Œè¿˜æ˜¯ä¸æˆã€‚äºæ˜¯`su peter`è®¿é—®ç›®å½•å‘ç°Linuxæƒé™æ˜¯æ‹’ç»çš„...æŠŠpeteræå‡è‡³ç»„ç®¡ç†å‘˜ä¹Ÿä»¥å¤±è´¥å‘Šç»ˆã€‚

å†é˜…è¯»é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆvalid useræ˜¯ç”Ÿæ•ˆçš„ï¼Œå› ä¸ºç”Ÿæ•ˆåæ‰èƒ½è§ç€å…±äº«ç›®å½•ï¼Œè®¿é—®å—é™æ˜¯å› ä¸ºLinuxçš„æ™®é€šç”¨æˆ·æ ¹æœ¬æ— æ³•è®¿é—®å…¶ä»–ç”¨æˆ·çš„å®¶ç›®å½•æ–‡ä»¶ã€‚äºæ˜¯åˆå°è¯•äº†ä»¥ä¸‹æ–¹æ³•ï¼š

* chgrp -R ç»„å æ–‡ä»¶/ç›®å½•å      è¡¨ç¤ºé€’å½’ä¿®æ”¹æ–‡ä»¶/ç›®å½•çš„æ‰€å±ç»„ï¼
* create directory maskå‡çº§åˆ°777

ä»¥ä¸Šéƒ½æ— æ•ˆï¼Œç»ˆäº

```
chown -R peter:test guest # æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•çš„æ‹¥æœ‰è€…çš†è®¾ä¸ºpeterï¼Œä½¿ç”¨ç¾¤ç»„test
```

æˆåŠŸäº†è¿›å…¥å…±äº«ç›®å½•ï¼Œpeteræ˜¯å¯ä»¥rwxçš„ï¼Œæˆ‘ä»¬å†å°†æ­¤å‰åˆ›å»ºçš„ç”¨æˆ·åŠ å…¥åˆ°testç»„æµ‹è¯•ï¼Œç»“æœè®¿é—®æ— æ•ˆï¼ğŸ˜±æ€æ ·æ‰èƒ½è®©smbé…ç½®@testç”Ÿæ•ˆå‘¢ï¼Ÿ

### è·³å‘è½¬æœº

æˆ‘çš„å½“å‰æƒ…å†µæ˜¯ç”¨æˆ·publicæœ‰ä¸¤ä¸ªç»„ï¼Œtestã€guestï¼›äºæ˜¯æˆ‘`usermod -g test public` æ”¹æˆä¸€ä¸ªtestç»„ï¼Œå»æ‰guestçœ‹çœ‹è¡Œä¸è¡Œï¼Ÿå±…ç„¶è¿˜æ˜¯ä¸è¡Œï¼ï¼ï¼

æœ€åå‚è€ƒ [ã€Linuxã€‘Linuxä¸‹æ–‡ä»¶çš„æƒé™ç®¡ç†å’Œæ‰€å±ç”¨æˆ·æ‰€å±ç»„](https://www.cnblogs.com/html55/p/13516659.html)æ‰€è¯´çš„ï¼š

> **æƒé™è¦ä»æœ€å¤–å±‚çš„æ–‡ä»¶å¤¹å¼€å§‹è¿›å…¥**ï¼Œ**çˆ¶çº§æ–‡ä»¶å¤¹åªè¦æœ‰xæƒé™ï¼Œé‚£ä¹ˆå­çº§æ–‡ä»¶å¤¹å°±ä¸å—çˆ¶çº§æ–‡ä»¶å¤¹çš„å½±å“äº†ã€‚çˆ¶çº§æ–‡ä»¶å¤¹æ²¡æœ‰xæƒé™ï¼Œå…¶ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åœ¨æ“ä½œæ—¶ä¼šå—åˆ°å½±å“ã€‚**
>
> **æœ‰ç‚¹ç±»ä¼¼å¤§é™¢å­åµŒå¥—å°é™¢å­ï¼Œå¤§é™¢å­æ²¡æœ‰xæƒé™ï¼ˆæ²¡æœ‰é’¥åŒ™ï¼‰ï¼Œå°±è¿›å…¥ä¸äº†å¤§é™¢å­ï¼Œé‚£ä½ ä»¬çš„å°é™¢å­ï¼Œä½ æœ‰é’¥åŒ™ä¹Ÿæ²¡æœ‰ç”¨ã€‚**

é©¬ä¸Šç”¨`ls -ll /home`æŸ¥çœ‹äº†ä¸‹æƒé™ï¼Œäºæ˜¯å‘ç°äº†å…¶ä¸­çš„ç«¯å€ªï¼Œäºæ˜¯å°†æ‰€å±ç»„æƒé™æ”¹æˆ 4+2+1ï¼Œè¿™æ¬¡æ€»ç®—æ˜¯æ˜ç™½äº†é—®é¢˜æ‰€åœ¨ï¼Œæ€»ç®—æå®šäº†ã€‚

> å‚è€ƒ[Linux ä¹‹ ç”¨æˆ·ã€ç”¨æˆ·ç»„ä»¥åŠæƒé™](https://www.cnblogs.com/xs104/p/4510114.html)
>
> * å›¾ä¸­çš„dä»£è¡¨ç›®å½•ï¼›å¦å¤–ï¼Œlä»£è¡¨linkã€bå‚¨å­˜è®¾å¤‡ã€cé”®ç›˜ã€é¼ æ ‡ç­‰ã€‚

![5-11.png](https://i.loli.net/2020/11/08/ROABXQvo4xGmkHD.png)

**å°†æ–‡ä»¶ç›®å½•åˆ†é…ç»™æŸä¸ªæŒ‡å®šç»„ï¼Œä¸ä»£è¡¨æŒ‡å®šç»„å°±æœ‰è¯»å†™æ‰§è¡Œæƒé™ï¼Œè¿™æ‰æ˜¯å…³é”®ï¼Windowsçš„æ€ç»´æœ‰äº›ä¸¥é‡äº†ï¼Œèµ°äº†å¾ˆå¤§çš„å¼¯è·¯ã€‚**ä½†å¦‚æœ `chmod 770 -R -v /home`åˆå‡ºç°äº†åŒç±»å‹çŠ¶å†µã€‚

![4-01.png](https://i.loli.net/2020/11/08/4eFEQZ6qOu3GWiU.png)

å› ä¸ºä¸çŸ¥é“homeåŸå…ˆæƒé™ï¼Œå¤§è„‘ä¹Ÿè¢«æŠ˜è…¾èƒ€äº†ï¼Œæ— å¥ˆå°†Linuxè¿˜åŸğŸ˜”ï¼ŒLinuxåˆå§‹homeæƒé™æ˜¯755

![4-5.png](https://i.loli.net/2020/11/08/xuqmMH7bf9oFwiI.png)

ç”±äºæˆ‘ä»¬æŠŠLinuxè¿˜åŸéœ€è¦é‡æ–°é…ç½®sambaï¼Œè¿™é‡Œåšä¸ªå°æ€»ç»“ï¼š

* åˆ›å»ºLinuxç”¨æˆ·ä¸sambaç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·åˆ†é…åˆ°ç‰¹å®šç»„
* å°†ç›®å½•æƒé™åˆ†é…åˆ°ç‰¹å®šç»„ï¼Œè®¾ç½®ç¾¤ç®¡ç†
* åˆ›å»ºå…±äº«ç›®å½•å¹¶åœ¨smb.confé…ç½®
* ç®¡ç†->æœåŠ¡->workstationé‡å¯å¯ä»¥æ¸…é™¤smbè´¦å·ä¿¡æ¯ï¼Œå®Œæˆé‡æ–°ç™»å½•

## Linuxç²˜æ»ä½

å›é¡¾ä¸ŠèŠ‚ï¼Œæˆ‘ä»¬æ‰©å±•é˜…è¯»äº†[Linuxæ–‡ä»¶æƒé™ä¸å±æ€§è¯¦è§£ ä¹‹ SUIDã€SGID & SBIT](https://www.cnblogs.com/Jimmy1988/p/7260215.html)ï¼Œéƒ¨åˆ†æ–‡ä»¶é™¤rwxé¢å¤–å¸¦â€œsâ€ä¸â€œtâ€ï¼Œså³ä¸ºè®¾ç½®uidã€gidï¼Œtå³ä¸ºç²˜æ»ä½ï¼Œç²˜æ»ä½ä½œç”¨æ˜¯ä»¥é˜²æ­¢æ™®é€šç”¨æˆ·åˆ é™¤æˆ–ç§»åŠ¨å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶ã€‚å¤„äºä¸šåŠ¡éœ€è¦ï¼Œç”¨æˆ·ä¹Ÿéœ€è¦å‘ç›®å½•å†™å…¥æ–‡ä»¶ã€åˆ é™¤è‡ªå·±çš„æ–‡ä»¶ï¼Œä½†ä¸èƒ½èƒ¡ä¹±åˆ é™¤åŒäº‹çš„æ–‡ä»¶ï¼ŒåŸºäºè¿™ä¸ªè¦æ±‚è®¾ç½®

`chmod -R o+t  /home/guest/ # æ·»åŠ ç›®å½•ç²˜æ»ä½`ä½†è¿™ä¹ˆä¸€æ¥ï¼Œæ–‡ä»¶æ‰€å±äººåˆåˆ é™¤ä¸äº†å…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶äº†ã€‚

![8-47.png](https://i.loli.net/2020/11/08/uCNIeLxpV96Kocd.png)

æ­¤æ—¶smb.confè®¾ç½®ç›®å½•çš„admin useré”®å³å¯è§£å†³è¿™ç±»é—®é¢˜ã€‚

![44-02.png](https://i.loli.net/2020/11/08/5aRG6kiCw4Pojef.png)


## å‚è€ƒæ–‡çŒ®

* [Sambaå…±äº«æƒé™åˆ†é…](https://www.cnblogs.com/liuquan/p/5644760.html)
* [èœé¸Ÿæ•™ç¨‹-Linux å‘½ä»¤å¤§å…¨](https://www.runoob.com/linux/linux-command-manual.html)
* [Linuxæ–‡ä»¶æƒé™ä¸å±æ€§è¯¦è§£ ä¹‹ SUIDã€SGID & SBIT](https://www.cnblogs.com/Jimmy1988/p/7260215.html)
*  [Linuxä¸­çš„ç»„ç®¡ç†å‘˜-gpasswd](https://blog.csdn.net/u010599211/article/details/84969308)
* [ã€Linuxã€‘æ–‡ä»¶çš„æƒé™ç®¡ç†åŠç‰¹æ®Šå±æ€§-ç²˜æ»ä½ï¼ˆsticky bitï¼‰æ¦‚è¿°](https://blog.csdn.net/her__0_0/article/details/53930785)
* [Linux ä¹‹ ç”¨æˆ·ã€ç”¨æˆ·ç»„ä»¥åŠæƒé™](https://www.cnblogs.com/xs104/p/4510114.html)
* [ç¬¬åå…­ç« ã€æª”æ¡ˆä¼ºæœå™¨ä¹‹äºŒï¼š SAMBA ä¼ºæœå™¨](http://linux.vbird.org/linux_server/0370samba.php)
*  [jb51net-Centos 7 SambaæœåŠ¡å®‰è£…æ–¹æ³•è¯¦è§£](https://www.jb51.net/article/162573.htm)